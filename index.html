<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>NexusList - Fixed & Responsive</title>
  <style>
    :root { --bg-gradient-start: #e0f2fe; --bg-gradient-end: #f9fafb; --card-bg: white; --card-border: rgba(148,163,184,0.3); --text-primary: #0f172a; --text-secondary: #64748b; --input-bg: #f9fafb; --input-border: #cbd5e1; --item-bg: #f9fafb; --shadow-color: rgba(15,23,42,0.12); --qty-text: #0369a1; }
    .dark-mode { --bg-gradient-start: #0f172a; --bg-gradient-end: #020617; --card-bg: #1e293b; --card-border: rgba(255,255,255,0.1); --text-primary: #f8fafc; --text-secondary: #94a3b8; --input-bg: #334155; --input-border: #475569; --item-bg: #334155; --shadow-color: rgba(0,0,0,0.4); --qty-text: #fbbf24; }
    body { font-family: system-ui, -apple-system, sans-serif; max-width: 640px; margin: 0 auto; padding: 0 16px 40px; background: radial-gradient(circle at top left, var(--bg-gradient-start), var(--bg-gradient-end)); min-height: 100vh; color: var(--text-primary); transition: background 0.3s; }
    .card { background: var(--card-bg); border-radius: 18px; box-shadow: 0 18px 40px var(--shadow-color); padding: 22px 18px 26px; border: 1px solid var(--card-border); margin-top: 24px; }
    .logo-wrapper { display: flex; justify-content: center; margin-bottom: 12px; }
    .logo-wrapper img { height: 120px; border-radius: 20px; }
    .bubble-btn { padding: 8px 16px; border-radius: 25px; border: 2px solid #cbd5e1; background: #f8fafc; color: #1e293b; font-size: 13px; cursor: pointer; transition: all 0.2s; }
    .bubble-btn.active { background: #3b82f6 !important; border-color: #3b82f6 !important; color: white !important; }
    .tab-btn { padding: 6px 12px; border-radius: 10px; border: 1px solid #cbd5e1; background: #f8fafc; color: #64748b; font-size: 11px; cursor: pointer; white-space: nowrap; }
    .tab-btn.active-tab { background: #3b82f6; color: white; border-color: #3b82f6; }
    .input-row { display: flex; gap: 8px; margin-top: 20px; }
    input { padding: 12px; border-radius: 999px; border: 1px solid var(--input-border); background: var(--input-bg); color: var(--text-primary); outline: none; }
    #itemInput { flex: 2; } #qtyInput { width: 60px; text-align: center; }
    .primary-btn { background: linear-gradient(135deg, #4f46e5, #22c55e); color: white; border: none; font-weight: bold; cursor: pointer; padding: 12px 20px; border-radius: 999px; }
    ul { list-style: none; padding: 0; margin-top: 20px; }
    li { padding: 12px; background: var(--item-bg); margin: 8px 0; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px var(--shadow-color); }
    .done { text-decoration: line-through; opacity: 0.5; }
    .footer-links { margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--card-border); text-align: center; font-size: 11px; }
    .modal-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:2000; align-items:center; justify-content:center; }
    .member-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
</head>
<body>
  <div id="signin-container" style="display:none; padding: 20px; text-align:center;">
    <div class="card"><h2>NexusList</h2><button class="primary-btn" onclick="signInWithGoogle()">üîê Sign in with Google</button></div>
  </div>

  <div id="app-container" style="display:none;">
    <div id="sharedBanner" style="display:none; background:#dcfce7; padding:10px; border-radius:12px; margin-bottom:10px; text-align:center;">üåç <span id="wsName"></span></div>
    <div class="card">
      <div id="workspaceSwitcher" style="display:flex; gap:8px; margin-bottom:15px; overflow-x:auto;"></div>
      <div id="bubbleContainer" style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
        <button class="bubble-btn active" onclick="changeList('shopping')">üõí Shopping</button>
        <button class="bubble-btn" onclick="changeList('reminder')">üìù Reminder</button>
        <button class="bubble-btn" onclick="changeList('todo')">‚úì To-do</button>
        <span id="customBubbles"></span>
        <button onclick="showModal('customModal')" style="border-radius:50%; width:35px; height:35px; border:1px solid #cbd5e1; cursor:pointer;">+</button>
      </div>
      <div class="input-row">
        <input id="qtyInput" type="text" placeholder="Qty">
        <input id="itemInput" placeholder="Add item...">
        <button class="primary-btn" onclick="addItem()">Add</button>
      </div>
      <ul id="list"></ul>
      <div style="text-align:center;"><button class="tab-btn" onclick="clearDone()">üßπ Clear Checked</button></div>
      <div id="sync-status" style="font-size:10px; text-align:center; margin-top:10px; opacity:0.6;"></div>
      <div style="display:flex; justify-content:center; gap:10px; margin-top:20px;">
        <button id="createWsBtn" class="tab-btn" style="background:#22c55e; color:white;" onclick="showModal('wsModal')">‚ú® Create Shared</button>
        <button id="shareBtn" class="tab-btn" style="background:#3b82f6; color:white; display:none;" onclick="copyLink()">üîó Share Link</button>
        <button class="tab-btn" onclick="toggleDark()">üåô Dark</button>
        <button class="tab-btn" onclick="auth.signOut()">Sign Out</button>
      </div>
      <div class="footer-links">
        <div id="memberBox" style="display:none; background:rgba(0,0,0,0.05); padding:10px; border-radius:10px; margin-bottom:10px;">
          <strong>Members:</strong> <div id="memberList"></div>
          <button onclick="leaveGroup()" style="color:red; margin-top:5px;">üö™ Leave Group</button>
        </div>
        <button onclick="clearHistory()">Clear History</button>
      </div>
    </div>
  </div>

  <div id="customModal" class="modal-overlay"><div class="card"><h3>New Category</h3><input id="newCatName"><button class="primary-btn" onclick="createCat()">Create</button><button onclick="hideModal('customModal')">Cancel</button></div></div>
  <div id="wsModal" class="modal-overlay"><div class="card"><h3>Shared List Name</h3><input id="newWsName"><button class="primary-btn" onclick="createWs()">Create</button><button onclick="hideModal('wsModal')">Cancel</button></div></div>

<script>
  const firebaseConfig = { apiKey: "AIzaSyA9VVZ6Cj-2zm52FZyEI_kpg3J9LKFpTPY", authDomain: "nexuslist-380ff.firebaseapp.com", databaseURL: "https://nexuslist-380ff-default-rtdb.firebaseio.com", projectId: "nexuslist-380ff", storageBucket: "nexuslist-380ff.firebasestorage.app", messagingSenderId: "950145923798", appId: "1:950145923798:web:050a4a08f99cae13e72777" };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database(), auth = firebase.auth();

  let user = null, currentWs = "", currentType = "shopping", shared = JSON.parse(localStorage.getItem('sharedGroups') || "[]");

  auth.onAuthStateChanged(u => {
    if (u) {
      user = u; applyDark();
      const urlG = new URLSearchParams(window.location.search).get('group');
      if (urlG && urlG !== u.uid && !shared.find(s=>s.id===urlG)) { shared.push({id:urlG, name:"Joined List"}); localStorage.setItem('sharedGroups', JSON.stringify(shared)); }
      switchWs(urlG || u.uid);
      document.getElementById('signin-container').style.display='none';
      document.getElementById('app-container').style.display='block';
    } else {
      document.getElementById('signin-container').style.display='block';
      document.getElementById('app-container').style.display='none';
    }
  });

  async function switchWs(id) {
    db.ref(`nexuslist/${currentWs}`).off();
    currentWs = id;
    const isPrivate = id === user.uid;
    
    if (!isPrivate) {
      await db.ref(`nexuslist/${id}/members/${user.uid}`).set({name: user.displayName || "User"});
      document.getElementById('memberBox').style.display = 'block';
      db.ref(`nexuslist/${id}/members`).on('value', s => {
        let h = ''; s.forEach(m => { h += `<div class="member-row">${m.val().name}</div>`; });
        document.getElementById('memberList').innerHTML = h;
      });
    } else { document.getElementById('memberBox').style.display = 'none'; }

    document.getElementById('wsName').textContent = isPrivate ? "My Lists" : "Shared Workspace";
    document.getElementById('sharedBanner').style.display = isPrivate ? 'none' : 'block';
    document.getElementById('shareBtn').style.display = isPrivate ? 'none' : 'inline-block';
    document.getElementById('createWsBtn').style.display = isPrivate ? 'inline-block' : 'none';

    renderSwitch();
    loadCats();
    changeList('shopping');
  }

  function renderSwitch() {
    let h = `<button class="tab-btn ${currentWs===user.uid?'active-tab':''}" onclick="switchWs('${user.uid}')">My Private List</button>`;
    shared.forEach(g => { h += `<button class="tab-btn ${currentWs===g.id?'active-tab':''}" onclick="switchWs('${g.id}')">${g.name}</button>`; });
    document.getElementById('workspaceSwitcher').innerHTML = h;
  }

  function loadCats() {
    db.ref(`nexuslist/${currentWs}/custom_categories`).on('value', s => {
      let h = ''; s.forEach(c => { h += `<button class="bubble-btn ${currentType===c.key?'active':''}" onclick="changeList('${c.key}')">${c.val().name}</button>`; });
      document.getElementById('customBubbles').innerHTML = h;
    });
  }

  function changeList(t) {
    db.ref(`nexuslist/${currentWs}/${currentType}`).off();
    currentType = t;
    document.querySelectorAll('.bubble-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase().includes(t)));
    db.ref(`nexuslist/${currentWs}/${currentType}`).on('value', s => {
      let h = ''; s.forEach(i => {
        if (['members','metadata','custom_categories'].includes(i.key)) return;
        const d = i.val();
        h += `<li><span class="${d.done?'done':''}">${d.text} ${d.qty?`(${d.qty})`:''}</span><div><button onclick="toggleItem('${i.key}',${d.done})">${d.done?'Undo':'Done'}</button><button onclick="delItem('${i.key}')">X</button></div></li>`;
      });
      document.getElementById('list').innerHTML = h;
      document.getElementById('sync-status').innerText = "Last sync: " + new Date().toLocaleTimeString();
    });
  }

  function addItem() {
    const i = document.getElementById('itemInput'), q = document.getElementById('qtyInput');
    if (!i.value) return;
    db.ref(`nexuslist/${currentWs}/${currentType}`).push({text: i.value, qty: q.value, done: false});
    i.value = ''; q.value = '';
  }

  function toggleItem(k, s) { db.ref(`nexuslist/${currentWs}/${currentType}/${k}`).update({done: !s}); }
  function delItem(k) { db.ref(`nexuslist/${currentWs}/${currentType}/${k}`).remove(); }
  function clearDone() { db.ref(`nexuslist/${currentWs}/${currentType}`).once('value', s => { s.forEach(i => { if(i.val().done) i.ref.remove(); }); }); }
  function createCat() { const n = document.getElementById('newCatName').value; if(n) db.ref(`nexuslist/${currentWs}/custom_categories`).push({name:n}); hideModal('customModal'); }
  function createWs() {
    const n = document.getElementById('newWsName').value, id = "group_"+Math.random().toString(36).substr(2,9);
    db.ref(`nexuslist/${id}`).set({metadata:{name:n, owner:user.uid}, members:{[user.uid]:{name:user.displayName}}}).then(() => {
      shared.push({id, name:n}); localStorage.setItem('sharedGroups', JSON.stringify(shared)); switchWs(id); hideModal('wsModal');
    });
  }
  function leaveGroup() { if(confirm("Leave?")) { db.ref(`nexuslist/${currentWs}/members/${user.uid}`).remove(); shared = shared.filter(s=>s.id!==currentWs); localStorage.setItem('sharedGroups', JSON.stringify(shared)); switchWs(user.uid); } }
  function toggleDark() { const d = localStorage.getItem('darkMode')!=='true'; localStorage.setItem('darkMode', d); applyDark(); }
  function applyDark() { document.documentElement.classList.toggle('dark-mode', localStorage.getItem('darkMode')==='true'); }
  function showModal(m) { document.getElementById(m).style.display='flex'; }
  function hideModal(m) { document.getElementById(m).style.display='none'; }
  function copyLink() { navigator.clipboard.writeText(window.location.origin + window.location.pathname + "?group=" + currentWs); alert("Copied!"); }
  function clearHistory() { localStorage.setItem('sharedGroups', '[]'); location.reload(); }
  function signInWithGoogle() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
</script>
</body>
</html>
